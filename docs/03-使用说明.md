# 使用说明文档

## 1. 快速开始

### 1.1 系统启动
1. 将配置好的SD卡插入树莓派4B
2. 连接电源启动系统
3. 系统会自动启动所有服务

### 1.2 网络连接
- **有WiFi环境**: 系统自动连接已配置的WiFi网络
- **无WiFi环境**: 系统自动开启热点模式
  - 热点名称: `RasPi-DataCollector`
  - 热点密码: `raspberry2024`
  - 热点IP: `192.168.4.1`

### 1.3 访问Web界面
- 浏览器访问: `http://树莓派IP:5000`
- 管理面板: `http://树莓派IP:5000/admin`

## 2. 手机扫码提交数据

### 2.1 获取二维码
1. 访问Web界面主页
2. 页面底部显示访问二维码
3. 用手机扫描二维码直接访问

### 2.2 提交数据流程
1. 选择数据类型（问卷调查、意见反馈等）
2. 填写标题和详细内容
3. 可选填写联系方式
4. 上传相关附件（图片、文档等）
5. 点击"提交数据"按钮
6. 系统显示提交成功确认

### 2.3 离线提交
- 无网络连接时仍可正常提交
- 数据存储在树莓派本地数据库
- 联网后自动同步到云端

## 3. Windows电脑访问数据

### 3.1 通过Samba共享访问
1. 打开Windows文件资源管理器
2. 在地址栏输入: `\\树莓派IP`
3. 选择相应的共享文件夹:
   - `data-readonly`: 只读访问所有数据
   - `data-readwrite`: 读写访问（需要密码）
   - `submissions`: 提交的数据文件
   - `uploads`: 上传的附件文件

### 3.2 用户认证
- **匿名访问**: 可访问只读共享
- **pi用户**: 管理员权限，可访问所有共享
- **datauser**: 数据用户，可读写数据目录

### 3.3 通过Web界面查看
1. 访问管理面板: `http://树莓派IP:5000/admin`
2. 查看实时统计信息
3. 浏览所有提交记录
4. 查看详细数据内容
5. 下载附件文件

## 4. 云端数据同步

### 4.1 配置云端API
1. 编辑配置文件: `/home/pi/data/config/cloud_config.json`
2. 设置草料二维码API参数:
```json
{
  "api_key": "你的API密钥",
  "api_secret": "你的API密钥",
  "sync_enabled": true,
  "auto_sync": true,
  "sync_interval": 300
}
```

### 4.2 同步状态监控
- Web管理面板显示同步状态
- 查看"待同步"数据数量
- 手动触发同步操作

### 4.3 同步日志
```bash
# 查看同步日志
tail -f /home/pi/data/logs/cloud_sync.log

# 手动执行同步
python3 /home/pi/shumeipai/scripts/cloud_sync.py
```

## 5. 系统管理

### 5.1 SSH远程管理
```bash
# 连接到树莓派
ssh pi@树莓派IP

# 查看系统状态
sudo systemctl status flask-server
sudo systemctl status smbd
sudo systemctl status wifi-hotspot
```

### 5.2 数据备份
```bash
# 创建系统镜像备份
sudo /home/pi/shumeipai/scripts/system_backup.sh

# 查看可用备份
sudo /home/pi/shumeipai/scripts/system_backup.sh list

# 清理过期备份
sudo /home/pi/shumeipai/scripts/system_backup.sh cleanup
```

### 5.3 日志查看
```bash
# Flask服务日志
tail -f /home/pi/data/logs/flask_server.log

# WiFi热点日志
tail -f /home/pi/data/logs/wifi_hotspot.log

# 系统日志
sudo journalctl -f
```

## 6. 数据文件结构

### 6.1 目录结构
```
/home/pi/data/
├── submissions/          # 提交的数据文件
├── uploads/             # 上传的附件文件
├── logs/               # 系统日志文件
├── config/             # 配置文件
├── backups/            # 系统备份文件
└── submissions.db      # SQLite数据库
```

### 6.2 数据库表结构
- **submissions**: 数据提交记录
- **system_logs**: 系统日志记录

### 6.3 文件命名规则
- 提交数据: `submission_YYYYMMDD_HHMMSS.json`
- 上传文件: `YYYYMMDD_HHMMSS_原文件名`
- 日志文件: `服务名_YYYYMMDD.log`

## 7. 故障处理

### 7.1 服务重启
```bash
# 重启Flask服务
sudo systemctl restart flask-server

# 重启Samba服务
sudo systemctl restart smbd nmbd

# 重启WiFi热点服务
sudo systemctl restart wifi-hotspot
```

### 7.2 网络问题
```bash
# 检查网络状态
ip addr show
iwconfig

# 手动切换WiFi模式
sudo /home/pi/shumeipai/scripts/wifi_hotspot.sh connect-wifi

# 手动开启热点
sudo /home/pi/shumeipai/scripts/wifi_hotspot.sh start-hotspot
```

### 7.3 数据库问题
```bash
# 检查数据库完整性
sqlite3 /home/pi/data/submissions.db "PRAGMA integrity_check;"

# 备份数据库
cp /home/pi/data/submissions.db /home/pi/data/backups/
```

## 8. 安全建议

### 8.1 密码安全
- 修改默认用户密码
- 设置强密码策略
- 定期更新密码

### 8.2 网络安全
- 配置防火墙规则
- 限制SSH访问
- 使用VPN连接

### 8.3 数据安全
- 定期备份数据
- 加密敏感信息
- 监控访问日志

## 9. 性能监控

### 9.1 系统资源
```bash
# CPU和内存使用情况
htop

# 磁盘使用情况
df -h

# 网络连接状态
netstat -tlnp
```

### 9.2 服务性能
- Web界面响应时间
- 数据库查询性能
- 文件传输速度

## 10. 扩展功能

### 10.1 自定义表单
- 修改HTML模板添加新字段
- 更新数据库表结构
- 调整API接口

### 10.2 多语言支持
- 添加语言配置文件
- 修改前端模板
- 更新提示信息

### 10.3 第三方集成
- 集成其他云端服务
- 添加消息通知功能
- 对接企业系统API
